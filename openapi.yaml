swagger: '2.0'
info:
  title: METRICS API
  description: >-
    The RESEARCH_DATA_SUSHI API represents a RESTful implementation of SUSHI
    automation intended to returns COUNTER Research Data Release 1 reports and snippets of usage in JSON format
  termsOfService: ''
  contact:
    name: DataCite METRICS API
    url: 'https://metrics.test.datacite.org'
    email: support@datacite.org
  license:
    name: MIT
    url: 'https://raw.githubusercontent.com/datacite/sashimi/master/LICENSE'
  version: "1.0.0"
schemes:
  - https
securityDefinitions:
  apikey:
    type: apiKey
    description: >-
      Unique code assigned by Content Provider to grant you access to this API. The apikey needs to be a query parameter for every operation to access this API.
    name: apikey
    in: query
  requestor_id:
    type: apiKey
    description: Identifies the requester(client) that is asking for report data
    name: requestor_id
    in: query
security:
  - apikey: []
    requestor_id: []
paths:
  /status:
    get:
      description: >-
        This resource returns the current status of the reporting service supported by this API.
      produces:
        - application/json
      parameters:
        - name: platform
          in: query
          description: >-
            Name of the Platform the report data is being requested for.  This can be omitted if the service provides report data for only one platform.
          type: string
      responses:
        '200':
          description: Status of the reporting service(s) supported by this API.
          schema:
            type: array
            items:
              $ref: '#/definitions/SUSHI_service_status'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
  /heartbeat:
    get:
      description: >-
        This resource returns the current status of the reporting service supported by this API.
      produces:
        - text/plain
      parameters:
        - name: status
          in: query
          description: >-
            Name of the Platform the report data is being requested for.  This can be omitted if the service provides report data for only one platform.
          type: string
      responses:
        '200':
          description: Status of the services provided by this API.
          schema:
            type: array
            items:
              $ref: '#/definitions/SUSHI_service_status'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
  /reports:
    get:
      description: >-
        This resource returns a list of reports supported by the API for a given application.
      produces:
        - application/json
      parameters:
        - name: platform
          in: query
          description: >-
            The name of the Platform the report data is being requested for.  This can be omitted if the service provides report data for only one platform.
          type: string
        - name: search
          in: query
          description: >-
            Keyword search filtered against report name. Allows for searching for a report by name.
          type: string
      responses:
        '200':
          description: List of reports supported by this service for this application.
          schema:
            type: array
            items:
              $ref: '#/definitions/SUSHI_report_list'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
  /reports/dsr:
    get:
      description: 'This resource returns a collection of Dataset reports.'
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
        - name: platform
          in: query
          description: >-
            Name of the Platform the usage is being requested for.  This can be omitted if the service provides usage for only one platform.
          type: string
        - name: report_name
          in: query
          type: string
          description: The long name of the report.
          example: Dataset Report
        - name: report_id
          type: string
          in: query
          description: >-
            The report ID or code or shortname. Typically this will be the same code provided in the Report parameter of the request.
          example: DSR
        - name: release
          type: string
          in: query
          description: The release or version of the report.
          example: 'RD1'
        - name: created
          type: string
          in: query
          format: dateTime
          description: Time the report was prepared. Format as defined by date-time - RFC3339
          example: '2016-09-08T22:47:31Z'
        - name: created_by
          type: string
          in: query
          description: Name of the organization producing the report.
          example: 'DataONE'
      responses:
        '200':
          description: 'Dataset Master Report (DSR).'
          schema:
            $ref: '#/definitions/COUNTER_dataset_report'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
    post:
      description: 'This resource returns a collection of Dataset reports.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: report
          in: body
          description: >-
            Report of metrics proccesed in SUSHI format.
          schema:
            $ref: "#/definitions/COUNTER_dataset_report"
      responses:
        '200':
          description: 'Collection of Dataset Reports'
          schema:
            $ref: '#/definitions/COUNTER_dataset_report'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
  /reports/dsr/{id}:
    get:
      description: 'This resource returns a specific Dataset report.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Report Unique ID. Identifier of a specific usage report is being requested for.  If omitted, all reports on the platform with usage will be returned.
          required: true
          type: string
      responses:
        '200':
          description: 'Usage Report Instance'
          schema:
            $ref: '#/definitions/COUNTER_dataset_report'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
    delete:
      description: 'This resource deletes a specific Dataset report.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Report Unique ID. Identifier of a specific usage report is being deleted.  If omitted, there should be a error.
          required: true
          type: string
      responses:
        '204':
          description: The resource was deleted successfully.
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
    put:
      description: 'This resource returns an updated Dataset report.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Report Unique ID. Identifier of a specific usage report is being modified.  If omitted, there should be a error.
          required: true
          type: string
      responses:
        '200':
          description: 'Report Updated.'
          schema:
            $ref: '#/definitions/COUNTER_dataset_report'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SUSHI_error_model'
  /publishers:
    get:
      description: 'This resource returns a collection of reports publishers.'
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
        - name: platform
          in: query
          description: >-
            Name of the Platform the usage is being requested for.  This can be omitted if the service provides usage for only one platform.
          type: string
        - name: report_id
          type: string
          in: query
          description: >-
            The report ID or code or shortname. Typically this will be the same code provided in the Report parameter of the request.
          example: DSR
      responses:
        '200':
          description: 'Collections of Usage Reports.'
          schema:
            $ref: '#/definitions/SASHIMI_publisher'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SASHIMI_error_model'
    post:
      description: 'This resource creates a new of report publisher.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: publisher_id
          in: body
          description: >-
            The ID of  the organisation Content providers implementing the Code of Practice for Research Data.
          schema:
            $ref: '#/definitions/SASHIMI_publisher'
      responses:
        '200':
          description: 'Publisher entity'
          schema:
            $ref: '#/definitions/SASHIMI_publisher'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SASHIMI_error_model'
  /publishers/{id}:
    get:
      description: 'This resource returns a specific report publisher.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Publisher Unique ID. Identifier of a specific report publisher. 
          required: true
          type: string
      responses:
        '200':
          description: 'Publisher Instance'
          schema:
            $ref: '#/definitions/SASHIMI_publisher'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SASHIMI_error_model'
    delete:
      description: 'This resource deletes a Publisher.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Publisher Unique ID. Identifier of a specific report publisher. 
          required: true
          type: string
      responses:
        '204':
          description: The resource was deleted successfully.
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SASHIMI_error_model'
    put:
      description: 'This resource returns an updated Publisher Record.'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          description: >-
            Publisher Unique ID. Identifier of a specific report publisher. 
          required: true
          type: string
      responses:
        '200':
          description: 'Report Updated.'
          schema:
            $ref: '#/definitions/SASHIMI_publisher'
        default:
          description: unexpected error
          schema:
            $ref: '#/definitions/SASHIMI_error_model'
definitions:
  SUSHI_error_model:
    type: object
    description: Generalized format for presenting errors and exceptions.
    required:
      - Code
      - Severity
      - Message
    properties:
      Code:
        type: integer
        format: int32
        description: Error number. See table of error.
        example: 3040
      Severity:
        type: string
        description: Severity of the error.
        example: Warning
        enum:
          - Warning
          - Fatal
          - Debug
          - Info
      Message:
        type: string
        description: Text describing the error.
        example: Partial Data Returned.
      Help_URL:
        type: string
        description: URL describing error details.
      Data:
        type: string
        description: Additional data provided by the server to clarify the error.
        example: Usage data has not been processed for all requested months.
  SASHIMI_error_model:
    type: object
    description: Generalized format for presenting errors and exceptions for the API.
    required:
      - Code
      - Severity
      - Message
    properties:
      Code:
        type: integer
        format: int32
        description: Error number. See table of error.
        example: 3040
      Severity:
        type: string
        description: Severity of the error.
        example: Warning
        enum:
          - Warning
          - Fatal
          - Debug
          - Info
      Message:
        type: string
        description: Text describing the error.
        example: Partial Data Returned.
      Help_URL:
        type: string
        description: URL describing error details.
      Data:
        type: string
        description: Additional data provided by the server to clarify the error.
        example: Usage data has not been processed for all requested months.
  SUSHI_report_header:
    type: object
    description: >-
      Generalized report header that defines the requested report, the
      requestor, the customer, filters applied, reportAttributes applied and any
      exceptions.
    required:
      - Report_Name
      - Report_ID
      - Release
    properties:
      Report_Name:
        type: string
        description: The long name of the report.
        example: Dataset Report
      Report_ID:
        type: string
        description: >-
          The report ID or code or shortname. Typically this will be the same code provided in the Report parameter of the request.
        example: DSR
      Release:
        type: string
        description: The release or version of the report.
        example: 'RD1'
      Created:
        type: string
        format: dateTime
        description: Time the report was prepared. Format as defined by date-time - RFC3339
        example: '2016-09-08T22:47:31Z'
      Created_By:
        type: string
        description: Name of the organization producing the report.
        example: 'DataONE'
      Report_Filters:
        type: array
        description: >-
          Zero or more report filters used for this report.  Typically  reflect filters provided on the Request.  Filters limit the data to be reported on.
        items:
          required:
            - Name
            - Value
          properties:
            Name:
              type: string
              description: Name of the report filter.
              example: Begin_Date
            Value:
              type: string
              description: Value of the report filter.
              example: 2015-01
      Report_Attributes:
        type: array
        description: >-
          Zero or more additional attributes applied to the report. Attributes inform the level of detail in the report.
        items:
          required:
            - Name
            - Value
          properties:
            Name:
              type: string
              description: Name of the report attribute.
              example: Exclude_Monthly_Details
            Value:
              type: string
              description: Name of the report attribute.
              example: 'True'
      Exceptions:
        type: array
        description: Series of exceptions encounted when preparing the report.
        items:
          $ref: '#/definitions/SUSHI_error_model'
  SUSHI_report_list:
    type: object
    required:
      - Report_ID
      - Report_Name
      - Release
      - Report_Description
    properties:
      Report_Name:
        type: string
        description: The long name of the report
        example: Dataset Report
      Report_ID:
        type: string
        description: >-
          The code, ID or short name of the report that is be used in the request to identify the report.
        example: DSR
      Release:
        type: string
        description: The release or version number of the report.
        example: 'RD1'
      Report_Description:
        type: string
        description: A short sentence describing the report.
        example: Usage by Month and Dataset
      Path:
        type: string
        description: The path to use when requesting this report on this service.
        example: /reports/dsr
  SASHIMI_publisher:
    type: object
    required:
      - Publisher_ID
      - Publisher_Name
    properties:
      Publisher_Name:
        type: string
        description: The long name of the publisher
        example: CDL
      Publisher_ID:
        type: string
        description: >-
          The PID of the publisher.
        example: CDLS3232323
      Path:
        type: string
        description: The path to use when requesting this report on this service.
        example: /reports/dsr
  SUSHI_service_status:
    type: object
    required:
      - ServiceActive
    properties:
      Description:
        type: string
        description: Description of the service.
        example: COUNTER Research Data Usage Reports for the UK Data Service - ReShare.
      ServiceActive:
        type: boolean
        description: Indicator if the service is currently able to deliver reports.
        example: true
      RegistryURL:
        type: string
        description: >-
          If available, the URL separate registry with additional information about the service.
        example: 'https://www.projectcounter.org/counter-user/ebsco-database/'
      Note:
        type: string
        description: A general note about the service.
        example: >-
          A given customer can request a maximum of 5 requests per day for a given report
      Alerts:
        type: array
        description: Any alerts related to service interuptions and status.
        items:
          type: object
          properties:
            Date_Time:
              type: string
              format: dateTime
              description: Date-time of the alert.
              example: '2016-08-02: 12:54'
            Alert:
              type: string
              description: Text of the alert.
              example: Service will be unavailable Sunday midnight...
  COUNTER_dataset_report:
    type: object
    description: Describes the formatting needs for the COUNTER Dataset Report. Response may include the Report_Header (optional), Report_Datasets (usage stats).
    required:
      - Report_Datasets
    properties:
      Report_Header:
        $ref: '#/definitions/SUSHI_report_header'
      Report_Datasets:
        type: array
        items:
          $ref: ''
host: metrics.test.datacite.org
basePath: /



